import{b as ue,o as fe,p as ge,c as P,q as D,d as me,t as F}from"../chunks/BYIqi1aN.js";import{p as b,h as K,d as q,T as ve,U as pe,o as he,ay as _e,g as we,n as ke,s as X,c as Y,t as be,Y as ye,X as $e,ar as Ce,q as te,a9 as T,u as ae,aa as C,ac as A,z as Le,ab as L,a8 as G,A as t,az as z,C as Pe,R as Ee,D as m}from"../chunks/BVU-3qzR.js";import{i as Ue,a as xe,s as Ne}from"../chunks/BW63avb5.js";import{e as ne,b as J,i as Se,a as Q}from"../chunks/CH4POJUP.js";import{m as Re,g as je,c as ze,e as Ae,f as Te}from"../chunks/B-StGhUn.js";import{o as Z}from"../chunks/Dphl-Ng_.js";import{a as ee}from"../chunks/DWs5udpD.js";import{i as Ie}from"../chunks/C3zVJj6d.js";import{s as V}from"../chunks/DiEe7jLX.js";import{l as I,p as N,s as re}from"../chunks/D5UK6Jkh.js";function Be(v,r,p,_,o,n){let a=b;b&&K();var i,g,c=null;b&&q.nodeType===1&&(c=q,K());var w=b?q:v,f;ve(()=>{const l=r()||null;var E=_e;l!==i&&(f&&(l===null?ye(f,()=>{f=null,g=null}):l===g?$e(f):Ce(f)),l&&l!==g&&(f=he(()=>{if(c=b?c:document.createElementNS(E,l),ue(c,c),_){b&&fe(l)&&c.append(document.createComment(""));var h=b?we(c):c.appendChild(ke());b&&(h===null?X(!1):Y(h)),_(c,h)}be.nodes_end=c,w.before(c)})),i=l,i&&(g=i))},pe),a&&(X(!0),Y(w))}/**
 * @license lucide-svelte v0.474.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Me={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var We=ge("<svg><!><!></svg>");function se(v,r){const p=I(r,["children","$$slots","$$events","$$legacy"]),_=I(p,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);te(r,!1);let o=N(r,"name",8,void 0),n=N(r,"color",8,"currentColor"),a=N(r,"size",8,24),i=N(r,"strokeWidth",8,2),g=N(r,"absoluteStrokeWidth",8,!1),c=N(r,"iconNode",24,()=>[]);const w=(...k)=>k.filter((d,U,x)=>!!d&&x.indexOf(d)===U).join(" ");Ie();var f=We();let l;var E=C(f);ne(E,1,c,Se,(k,d)=>{let U=()=>t(d)[0],x=()=>t(d)[1];var S=D(),B=G(S);Be(B,U,!0,(R,M)=>{let y;T(()=>y=J(R,y,{...x()}))}),P(k,S)});var h=A(E);V(h,r,"default",{}),L(f),T((k,d)=>l=J(f,l,{...Me,..._,width:a(),height:a(),stroke:n(),"stroke-width":k,class:d}),[()=>g()?Number(i())*24/Number(a()):i(),()=>w("lucide-icon","lucide",o()?`lucide-${o()}`:"",p.class)],Le),P(v,f),ae()}function Oe(v,r){const p=I(r,["children","$$slots","$$events","$$legacy"]);se(v,re({name:"chevron-left"},()=>p,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(o,n)=>{var a=D(),i=G(a);V(i,r,"default",{}),P(o,a)},$$slots:{default:!0}}))}function qe(v,r){const p=I(r,["children","$$slots","$$events","$$legacy"]);se(v,re({name:"chevron-right"},()=>p,{iconNode:[["path",{d:"m9 18 6-6-6-6"}]],children:(o,n)=>{var a=D(),i=G(a);V(i,r,"default",{}),P(o,a)},$$slots:{default:!0}}))}var De=F('<img alt="Manga Page">'),Fe=F('<audio class="background-sound" loop><source type="audio/ogg"></audio>'),Ge=F('<div class="container svelte-1e9j59m"><div class="manga-container svelte-1e9j59m" role="presentation"><button class="nav-button svelte-1e9j59m"><!></button> <div class="manga-content svelte-1e9j59m"><!> <!></div> <button class="nav-button svelte-1e9j59m"><!></button></div></div>');function at(v,r){te(r,!0);const[p,_]=xe(),o=()=>Ne(Re,"$manga",p);let n=z(0),a=z(0);Z(()=>(i(),window.addEventListener("popstate",i),window.addEventListener("pushstate",i),()=>{window.removeEventListener("popstate",i),window.removeEventListener("pushstate",i)}));const i=()=>{const e=new URLSearchParams(window.location.search),s=e.get("chapter"),u=e.get("page");s&&m(n,parseInt(s,10)||0,!0),u&&m(a,parseInt(u,10)||0,!0)};let g={};const c=async({page:e,chapterIndex:s})=>{const u=`${s}-${e}`;return g[u]===void 0&&(g[u]=URL.createObjectURL(await ze({chapterIndex:s,page:e}))),g[u]};let w={};const f=async e=>(w[e]===void 0&&(w[e]=URL.createObjectURL(await Ae(e))),w[e]);let l={};const E=async e=>(l[e]===void 0&&(l[e]=URL.createObjectURL(await Te(e))),l[e]);let h=z(null),k=z(Pe([]));function d(e){U(),e instanceof KeyboardEvent&&(e.key==="ArrowLeft"?(e.preventDefault(),x()):e.key==="ArrowRight"&&(e.preventDefault(),S()))}function U(){document.querySelectorAll(".background-sound").forEach(s=>{s instanceof HTMLAudioElement&&s.play().then(()=>{}).catch(u=>{console.error("Background sound play failed:",u)})})}function x(){if(t(a)>0)m(a,t(a)-1);else if(t(n)>0){if(o()&&o().chapters[t(n)-1]){const e=o().chapters[t(n)-1].pages.length-1;m(n,t(n)-1),m(a,e)}}else{alert("No more pages");return}ee(`/reader/?chapter=${t(n)}&page=${t(a)}`,{})}function S(){if(o()&&o().chapters[t(n)]&&t(a)<o().chapters[t(n)].pages.length-1)m(a,t(a)+1);else if(o()&&t(n)<o().chapters.length-1)m(a,0),m(n,t(n)+1);else{alert("No more pages");return}ee(`/reader/?chapter=${t(n)}&page=${t(a)}`,{})}const B=async({page:e,bgm:s,se:u,voice:O})=>{m(h,await c({page:e,chapterIndex:t(n)}),!0);let $=[];s!==null&&($=[...$,await f(s)]);for(const de of u)$=[...$,await E(de)];O&&($=[...$,URL.createObjectURL(await je({chapterIndex:t(n),page:e}))]),m(k,$,!0),setTimeout(U,100)};Ee(()=>{if(o()===null){alert("Manga not initialized");return}const e=o().chapters[t(n)];if(e===void 0){alert(`Chapter ${t(n)+1} not found`);return}const s=e.pages[t(a)];if(s===void 0){alert(`Page ${t(a)+1} not found`);return}B(s)}),Z(()=>(document.addEventListener("click",d),document.addEventListener("keydown",d),()=>{document.removeEventListener("click",d),document.removeEventListener("keydown",d)}));var R=Ge(),M=C(R),y=C(M);y.__click=x;var oe=C(y);Oe(oe,{size:48}),L(y);var j=A(y,2);j.__click=d,j.__keydown=d;var H=C(j);{var ie=e=>{var s=De();T(()=>Q(s,"src",t(h))),P(e,s)};Ue(H,e=>{t(h)!==null&&e(ie)})}var ce=A(H,2);ne(ce,16,()=>t(k),e=>e,(e,s)=>{var u=Fe(),O=C(u);L(u),T(()=>Q(O,"src",s)),P(e,u)}),L(j);var W=A(j,2);W.__click=S;var le=C(W);qe(le,{size:48}),L(W),L(M),L(R),P(v,R),ae(),_()}me(["click","keydown"]);export{at as component};
