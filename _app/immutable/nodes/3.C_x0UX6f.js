import{b as Pe,q as xe,s as Ce,c as k,o as W,g as Ee,t as te}from"../chunks/yXoHkmtp.js";import{p as C,h as se,d as Z,T as Ne,U as ze,o as Ae,aJ as Ue,g as Me,n as Se,s as re,c as le,t as Re,Y as Ve,X as Te,ap as Ie,q as fe,a9 as B,u as me,aa as b,ac as j,z as je,ab as y,a8 as M,A as a,aA as D,C as Be,R as We,D as h}from"../chunks/DZs8gjkn.js";import{i as ie,s as I,a as Oe,b as qe}from"../chunks/CMGm8hXo.js";import{e as ve,a as ce,i as De,s as ee}from"../chunks/Bt7EvAED.js";import{f as Fe,m as He,g as Ge,h as Je,i as Ke,j as Xe,b as Ye,s as Qe,v as Ze}from"../chunks/B8kLrR2h.js";import{o as de}from"../chunks/ZeUsTjY7.js";import{a as ue}from"../chunks/DFQjDAL1.js";import{i as et}from"../chunks/B9uL8g3S.js";import{s as O}from"../chunks/DG4eRyx6.js";import{l as U,p as A,s as F}from"../chunks/BAzXohFS.js";function tt(u,o,r,p,n,v){let l=C;C&&se();var c,w,t=null;C&&Z.nodeType===1&&(t=Z,se());var i=C?Z:u,f;Ne(()=>{const d=o()||null;var L=Ue;d!==c&&(f&&(d===null?Ve(f,()=>{f=null,w=null}):d===w?Te(f):Ie(f)),d&&d!==w&&(f=Ae(()=>{if(t=C?t:document.createElementNS(L,d),Pe(t,t),p){C&&xe(d)&&t.append(document.createComment(""));var E=C?Me(t):t.appendChild(Se());C&&(E===null?re(!1):le(E)),p(t,E)}Re.nodes_end=t,i.before(t)})),c=d,c&&(w=c))},ze),l&&(re(!0),le(i))}/**
 * @license lucide-svelte v0.474.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const at={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var ot=Ce("<svg><!><!></svg>");function H(u,o){const r=U(o,["children","$$slots","$$events","$$legacy"]),p=U(r,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);fe(o,!1);let n=A(o,"name",8,void 0),v=A(o,"color",8,"currentColor"),l=A(o,"size",8,24),c=A(o,"strokeWidth",8,2),w=A(o,"absoluteStrokeWidth",8,!1),t=A(o,"iconNode",24,()=>[]);const i=(..._)=>_.filter(($,N,S)=>!!$&&S.indexOf($)===N).join(" ");et();var f=ot();let d;var L=b(f);ve(L,1,t,De,(_,$)=>{let N=()=>a($)[0],S=()=>a($)[1];var z=W(),q=M(z);tt(q,N,!0,(P,G)=>{let R;B(()=>R=ce(P,R,{...S()}))}),k(_,z)});var E=j(L);O(E,o,"default",{}),y(f),B((_,$)=>d=ce(f,d,{...at,...p,width:l(),height:l(),stroke:v(),"stroke-width":_,class:$}),[()=>w()?Number(c())*24/Number(l()):c(),()=>i("lucide-icon","lucide",n()?`lucide-${n()}`:"",r.class)],je),k(u,f),me()}function nt(u,o){const r=U(o,["children","$$slots","$$events","$$legacy"]);H(u,F({name:"chevron-left"},()=>r,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(n,v)=>{var l=W(),c=M(l);O(c,o,"default",{}),k(n,l)},$$slots:{default:!0}}))}function st(u,o){const r=U(o,["children","$$slots","$$events","$$legacy"]);H(u,F({name:"chevron-right"},()=>r,{iconNode:[["path",{d:"m9 18 6-6-6-6"}]],children:(n,v)=>{var l=W(),c=M(l);O(c,o,"default",{}),k(n,l)},$$slots:{default:!0}}))}function rt(u,o){const r=U(o,["children","$$slots","$$events","$$legacy"]);H(u,F({name:"volume-2"},()=>r,{iconNode:[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z"}],["path",{d:"M16 9a5 5 0 0 1 0 6"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728"}]],children:(n,v)=>{var l=W(),c=M(l);O(c,o,"default",{}),k(n,l)},$$slots:{default:!0}}))}function lt(u,o){const r=U(o,["children","$$slots","$$events","$$legacy"]);H(u,F({name:"volume-x"},()=>r,{iconNode:[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15"}]],children:(n,v)=>{var l=W(),c=M(l);O(c,o,"default",{}),k(n,l)},$$slots:{default:!0}}))}function it(u,o,r){qe(r,!o())}var ct=te('<img class="manga-image svelte-rilp9l" alt="Manga Page">'),dt=te('<audio class="background-sound svelte-rilp9l"><source type="audio/ogg"></audio>'),ut=te('<div class="manga-container svelte-rilp9l" role="presentation"><div class="buttons-column svelte-rilp9l"><button class="nav-button svelte-rilp9l"><!></button></div> <div class="manga-content svelte-rilp9l"><!></div> <div class="buttons-column svelte-rilp9l"><button class="volume-button svelte-rilp9l"><!></button> <button class="nav-button svelte-rilp9l"><!></button></div></div> <!>',1);function kt(u,o){fe(o,!0);const[r,p]=Oe(),n=()=>I(He,"$manga",r),v=()=>I(f,"$isMuted",r),l=()=>I(Ye,"$bgmVolume",r),c=()=>I(Qe,"$seVolume",r),w=()=>I(Ze,"$voiceVolume",r);let t=D(0),i=D(0),f=Fe("muted",!1);de(()=>(d(),window.addEventListener("popstate",d),window.addEventListener("pushstate",d),()=>{window.removeEventListener("popstate",d),window.removeEventListener("pushstate",d)}));const d=()=>{const e=new URLSearchParams(window.location.search),s=e.get("chapter"),m=e.get("page");s&&h(t,parseInt(s,10)||0,!0),m&&h(i,parseInt(m,10)||0,!0)};let L={};const E=async({page:e,chapterIndex:s})=>{const m=`${s}-${e}`;return L[m]===void 0&&(L[m]=URL.createObjectURL(await Je({chapterIndex:s,page:e}))),L[m]};let _={};const $=async e=>(_[e]===void 0&&(_[e]=URL.createObjectURL(await Ke(e))),_[e]);let N={};const S=async e=>(N[e]===void 0&&(N[e]=URL.createObjectURL(await Xe(e))),N[e]);let z=D(null),q=D(Be([]));function P(e){G(),e instanceof KeyboardEvent&&(e.key==="ArrowLeft"?(e.preventDefault(),R()):e.key==="ArrowRight"&&(e.preventDefault(),ae()))}function G(){document.querySelectorAll(".background-sound").forEach(s=>{s instanceof HTMLAudioElement&&s.play().then(()=>{}).catch(m=>{console.error("Background sound play failed:",m)})})}function R(){if(a(i)>0)h(i,a(i)-1);else if(a(t)>0){if(n()&&n().chapters[a(t)-1]){const e=n().chapters[a(t)-1].pages.length-1;h(t,a(t)-1),h(i,e)}}else{alert("No more pages");return}ue(`/reader?chapter=${a(t)}&page=${a(i)}`,{})}function ae(){if(n()&&n().chapters[a(t)]&&a(i)<n().chapters[a(t)].pages.length-1)h(i,a(i)+1);else if(n()&&a(t)<n().chapters.length-1)h(i,0),h(t,a(t)+1);else{alert("No more pages");return}ue(`/reader?chapter=${a(t)}&page=${a(i)}`,{})}const pe=async({page:e,bgm:s,se:m,voice:Q})=>{h(z,await E({page:e,chapterIndex:a(t)}),!0);let g=[];s!==null&&(g=[...g,{url:await $(s),loop:!0,type:"bgm"}]);for(const x of m)g=[...g,{url:await S(x),loop:!0,type:"se"}];Q&&(g=[...g,{url:URL.createObjectURL(await Ge({chapterIndex:a(t),page:e})),loop:!1,type:"voice"}]),h(q,g,!0),setTimeout(G,100)};We(()=>{if(n()===null){alert("Manga not initialized");return}const e=n().chapters[a(t)];if(e===void 0){alert(`Chapter ${a(t)+1} not found`);return}const s=e.pages[a(i)];if(s===void 0){alert(`Page ${a(i)+1} not found`);return}pe(s)}),de(()=>(document.addEventListener("click",P),document.addEventListener("keydown",P),()=>{document.removeEventListener("click",P),document.removeEventListener("keydown",P)}));var oe=ut(),J=M(oe),K=b(J),X=b(K);X.__click=R;var ge=b(X);nt(ge,{size:48}),y(X),y(K);var V=j(K,2);V.__click=P,V.__keydown=P;var he=b(V);{var _e=e=>{var s=ct();B(()=>ee(s,"src",a(z))),k(e,s)};ie(he,e=>{a(z)!==null&&e(_e)})}y(V);var ne=j(V,2),T=b(ne);T.__click=[it,v,f];var $e=b(T);{var be=e=>{lt(e,{size:30})},ye=e=>{rt(e,{size:30})};ie($e,e=>{v()?e(be):e(ye,!1)})}y(T);var Y=j(T,2);Y.__click=ae;var ke=b(Y);st(ke,{size:48}),y(Y),y(ne),y(J);var we=j(J,2);ve(we,17,()=>a(q),({url:e,loop:s,type:m})=>e,(e,s)=>{let m=()=>a(s).url,Q=()=>a(s).loop,g=()=>a(s).type;var x=dt(),Le=b(x);y(x),B(()=>{x.loop=Q(),x.volume=(g()==="bgm"?l():g()==="se"?c():w())/100,x.muted=v(),ee(Le,"src",m())}),k(e,x)}),B(()=>ee(T,"aria-label",v()?"Unmute audio":"Mute audio")),k(u,oe),me(),p()}Ee(["click","keydown"]);export{kt as component};
