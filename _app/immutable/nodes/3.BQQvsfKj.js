import{b as ue,o as fe,p as ge,c as P,q as F,d as me,t as G}from"../chunks/BYIqi1aN.js";import{p as y,h as X,d as D,T as pe,U as ve,o as he,ay as _e,g as we,n as ke,s as Y,c as J,t as be,Y as ye,X as $e,ar as Ce,q as ae,a9 as T,u as ne,aa as C,ac as A,z as Le,ab as L,a8 as V,A as t,az as z,C as Pe,R as Ee,D as p}from"../chunks/BVU-3qzR.js";import{i as xe,a as Ne,s as Ue}from"../chunks/BW63avb5.js";import{e as oe,b as Q,i as Se,a as Z}from"../chunks/CH4POJUP.js";import{m as Re,g as je,c as ze,e as Ae,f as Te}from"../chunks/B-StGhUn.js";import{o as ee}from"../chunks/Dphl-Ng_.js";import{a as te}from"../chunks/B6OcQNqC.js";import{i as Ie}from"../chunks/C3zVJj6d.js";import{s as H}from"../chunks/DiEe7jLX.js";import{l as I,p as U,s as re}from"../chunks/D5UK6Jkh.js";function Be(v,r,h,w,s,n){let a=y;y&&X();var i,m,l=null;y&&D.nodeType===1&&(l=D,X());var k=y?D:v,u;pe(()=>{const c=r()||null;var E=_e;c!==i&&(u&&(c===null?ye(u,()=>{u=null,m=null}):c===m?$e(u):Ce(u)),c&&c!==m&&(u=he(()=>{if(l=y?l:document.createElementNS(E,c),ue(l,l),w){y&&fe(c)&&l.append(document.createComment(""));var _=y?we(l):l.appendChild(ke());y&&(_===null?Y(!1):J(_)),w(l,_)}be.nodes_end=l,k.before(l)})),i=c,i&&(m=i))},ve),a&&(Y(!0),J(k))}/**
 * @license lucide-svelte v0.474.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Me={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var We=ge("<svg><!><!></svg>");function se(v,r){const h=I(r,["children","$$slots","$$events","$$legacy"]),w=I(h,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);ae(r,!1);let s=U(r,"name",8,void 0),n=U(r,"color",8,"currentColor"),a=U(r,"size",8,24),i=U(r,"strokeWidth",8,2),m=U(r,"absoluteStrokeWidth",8,!1),l=U(r,"iconNode",24,()=>[]);const k=(...b)=>b.filter((d,x,N)=>!!d&&N.indexOf(d)===x).join(" ");Ie();var u=We();let c;var E=C(u);oe(E,1,l,Se,(b,d)=>{let x=()=>t(d)[0],N=()=>t(d)[1];var S=F(),B=V(S);Be(B,x,!0,(R,M)=>{let $;T(()=>$=Q(R,$,{...N()}))}),P(b,S)});var _=A(E);H(_,r,"default",{}),L(u),T((b,d)=>c=Q(u,c,{...Me,...w,width:a(),height:a(),stroke:n(),"stroke-width":b,class:d}),[()=>m()?Number(i())*24/Number(a()):i(),()=>k("lucide-icon","lucide",s()?`lucide-${s()}`:"",h.class)],Le),P(v,u),ne()}function Oe(v,r){const h=I(r,["children","$$slots","$$events","$$legacy"]);se(v,re({name:"chevron-left"},()=>h,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(s,n)=>{var a=F(),i=V(a);H(i,r,"default",{}),P(s,a)},$$slots:{default:!0}}))}function qe(v,r){const h=I(r,["children","$$slots","$$events","$$legacy"]);se(v,re({name:"chevron-right"},()=>h,{iconNode:[["path",{d:"m9 18 6-6-6-6"}]],children:(s,n)=>{var a=F(),i=V(a);H(i,r,"default",{}),P(s,a)},$$slots:{default:!0}}))}var De=G('<img alt="Manga Page">'),Fe=G('<audio class="background-sound"><source type="audio/ogg"></audio>'),Ge=G('<div class="container svelte-1e9j59m"><div class="manga-container svelte-1e9j59m" role="presentation"><button class="nav-button svelte-1e9j59m"><!></button> <div class="manga-content svelte-1e9j59m"><!> <!></div> <button class="nav-button svelte-1e9j59m"><!></button></div></div>');function at(v,r){ae(r,!0);const[h,w]=Ne(),s=()=>Ue(Re,"$manga",h);let n=z(0),a=z(0);ee(()=>(i(),window.addEventListener("popstate",i),window.addEventListener("pushstate",i),()=>{window.removeEventListener("popstate",i),window.removeEventListener("pushstate",i)}));const i=()=>{const e=new URLSearchParams(window.location.search),o=e.get("chapter"),f=e.get("page");o&&p(n,parseInt(o,10)||0,!0),f&&p(a,parseInt(f,10)||0,!0)};let m={};const l=async({page:e,chapterIndex:o})=>{const f=`${o}-${e}`;return m[f]===void 0&&(m[f]=URL.createObjectURL(await ze({chapterIndex:o,page:e}))),m[f]};let k={};const u=async e=>(k[e]===void 0&&(k[e]=URL.createObjectURL(await Ae(e))),k[e]);let c={};const E=async e=>(c[e]===void 0&&(c[e]=URL.createObjectURL(await Te(e))),c[e]);let _=z(null),b=z(Pe([]));function d(e){x(),e instanceof KeyboardEvent&&(e.key==="ArrowLeft"?(e.preventDefault(),N()):e.key==="ArrowRight"&&(e.preventDefault(),S()))}function x(){document.querySelectorAll(".background-sound").forEach(o=>{o instanceof HTMLAudioElement&&o.play().then(()=>{}).catch(f=>{console.error("Background sound play failed:",f)})})}function N(){if(t(a)>0)p(a,t(a)-1);else if(t(n)>0){if(s()&&s().chapters[t(n)-1]){const e=s().chapters[t(n)-1].pages.length-1;p(n,t(n)-1),p(a,e)}}else{alert("No more pages");return}te(`/reader/?chapter=${t(n)}&page=${t(a)}`,{})}function S(){if(s()&&s().chapters[t(n)]&&t(a)<s().chapters[t(n)].pages.length-1)p(a,t(a)+1);else if(s()&&t(n)<s().chapters.length-1)p(a,0),p(n,t(n)+1);else{alert("No more pages");return}te(`/reader/?chapter=${t(n)}&page=${t(a)}`,{})}const B=async({page:e,bgm:o,se:f,voice:O})=>{p(_,await l({page:e,chapterIndex:t(n)}),!0);let g=[];o!==null&&(g=[...g,{url:await u(o),loop:!0}]);for(const q of f)g=[...g,{url:await E(q),loop:!0}];O&&(g=[...g,{url:URL.createObjectURL(await je({chapterIndex:t(n),page:e})),loop:!1}]),p(b,g,!0),setTimeout(x,100)};Ee(()=>{if(s()===null){alert("Manga not initialized");return}const e=s().chapters[t(n)];if(e===void 0){alert(`Chapter ${t(n)+1} not found`);return}const o=e.pages[t(a)];if(o===void 0){alert(`Page ${t(a)+1} not found`);return}B(o)}),ee(()=>(document.addEventListener("click",d),document.addEventListener("keydown",d),()=>{document.removeEventListener("click",d),document.removeEventListener("keydown",d)}));var R=Ge(),M=C(R),$=C(M);$.__click=N;var ie=C($);Oe(ie,{size:48}),L($);var j=A($,2);j.__click=d,j.__keydown=d;var K=C(j);{var le=e=>{var o=De();T(()=>Z(o,"src",t(_))),P(e,o)};xe(K,e=>{t(_)!==null&&e(le)})}var ce=A(K,2);oe(ce,17,()=>t(b),({url:e,loop:o})=>e,(e,o)=>{let f=()=>t(o).url,O=()=>t(o).loop;var g=Fe(),q=C(g);L(g),T(()=>{g.loop=O(),Z(q,"src",f())}),P(e,g)}),L(j);var W=A(j,2);W.__click=S;var de=C(W);qe(de,{size:48}),L(W),L(M),L(R),P(v,R),ne(),w()}me(["click","keydown"]);export{at as component};
