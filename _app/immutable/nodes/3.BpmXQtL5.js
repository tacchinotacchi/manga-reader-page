import{b as ke,q as Pe,s as Le,o as q,c as _,j as xe,t as S}from"../chunks/CN1S20pl.js";import{p as C,h as se,d as Z,T as Ce,U as Ee,o as Ne,aJ as Me,g as ze,n as Ae,s as re,c as ie,t as Ue,Y as Se,X as Re,ao as Ve,q as ue,aa as P,a8 as R,ac as B,ab as L,a9 as O,y as Te,u as fe,z as a,aA as I,B as je,R as Ie,C as p}from"../chunks/BLiXIDi3.js";import{i as W,a as We,s as z,b as Be}from"../chunks/BF2NtrQn.js";import{e as me,i as Oe,a as le,s as ee}from"../chunks/DljTyexv.js";import{f as qe,m as Fe,g as He,i as Xe,h as De,j as Ge,k as Je,b as Ke,s as Ye,v as Qe}from"../chunks/CMHswb_d.js";import{o as ce}from"../chunks/Dwyf7C_h.js";import{a as de}from"../chunks/BFSr4wuC.js";import{i as Ze}from"../chunks/BrCeg3vt.js";import{s as F}from"../chunks/B0OIb8v0.js";import{l as U,p as A,s as D}from"../chunks/YqBnwoUK.js";function et(v,o,l,y,u,c){let r=C;C&&se();var d,x,f=null;C&&Z.nodeType===1&&(f=Z,se());var i=C?Z:v,n;Ce(()=>{const g=o()||null;var b=Me;g!==d&&(n&&(g===null?Se(n,()=>{n=null,x=null}):g===x?Re(n):Ve(n)),g&&g!==x&&(n=Ne(()=>{if(f=C?f:document.createElementNS(b,g),ke(f,f),y){C&&Pe(g)&&f.append(document.createComment(""));var w=C?ze(f):f.appendChild(Ae());C&&(w===null?re(!1):ie(w)),y(f,w)}Ue.nodes_end=f,i.before(f)})),d=g,d&&(x=d))},Ee),r&&(re(!0),ie(i))}/**
 * @license lucide-svelte v0.474.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const tt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var at=Le("<svg><!><!></svg>");function G(v,o){const l=U(o,["children","$$slots","$$events","$$legacy"]),y=U(l,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);ue(o,!1);let u=A(o,"name",8,void 0),c=A(o,"color",8,"currentColor"),r=A(o,"size",8,24),d=A(o,"strokeWidth",8,2),x=A(o,"absoluteStrokeWidth",8,!1),f=A(o,"iconNode",24,()=>[]);const i=(...E)=>E.filter(($,V,N)=>!!$&&N.indexOf($)===V).join(" ");Ze();var n=at();let g;var b=P(n);me(b,1,f,Oe,(E,$)=>{let V=()=>a($)[0],N=()=>a($)[1];var H=q(),T=R(H);et(T,V,!0,(X,j)=>{let M;O(()=>M=le(X,M,{...N()}))}),_(E,H)});var w=B(b);F(w,o,"default",{}),L(n),O((E,$)=>g=le(n,g,{...tt,...y,width:r(),height:r(),stroke:c(),"stroke-width":E,class:$}),[()=>x()?Number(d())*24/Number(r()):d(),()=>i("lucide-icon","lucide",u()?`lucide-${u()}`:"",l.class)],Te),_(v,n),fe()}function ot(v,o){const l=U(o,["children","$$slots","$$events","$$legacy"]);G(v,D({name:"chevron-left"},()=>l,{iconNode:[["path",{d:"m15 18-6-6 6-6"}]],children:(u,c)=>{var r=q(),d=R(r);F(d,o,"default",{}),_(u,r)},$$slots:{default:!0}}))}function nt(v,o){const l=U(o,["children","$$slots","$$events","$$legacy"]);G(v,D({name:"chevron-right"},()=>l,{iconNode:[["path",{d:"m9 18 6-6-6-6"}]],children:(u,c)=>{var r=q(),d=R(r);F(d,o,"default",{}),_(u,r)},$$slots:{default:!0}}))}function st(v,o){const l=U(o,["children","$$slots","$$events","$$legacy"]);G(v,D({name:"volume-2"},()=>l,{iconNode:[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z"}],["path",{d:"M16 9a5 5 0 0 1 0 6"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728"}]],children:(u,c)=>{var r=q(),d=R(r);F(d,o,"default",{}),_(u,r)},$$slots:{default:!0}}))}function rt(v,o){const l=U(o,["children","$$slots","$$events","$$legacy"]);G(v,D({name:"volume-x"},()=>l,{iconNode:[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15"}]],children:(u,c)=>{var r=q(),d=R(r);F(d,o,"default",{}),_(u,r)},$$slots:{default:!0}}))}function it(v,o,l){Be(l,!o())}var lt=S('<button class="volume-button svelte-1macyli"><!></button>'),ct=S('<div class="buttons-column svelte-1macyli"><button class="nav-button svelte-1macyli"><!></button></div>'),dt=S('<img class="manga-image svelte-1macyli" alt="Manga Page">'),ut=S('<div class="buttons-column svelte-1macyli"><button class="nav-button svelte-1macyli"><!></button></div>'),ft=S('<audio class="background-sound svelte-1macyli"><source type="audio/ogg"></audio>'),mt=S('<!> <div class="manga-container svelte-1macyli" role="presentation"><!> <div class="manga-content svelte-1macyli"><!></div> <!></div> <!>',1);function Pt(v,o){ue(o,!0);const[l,y]=We(),u=()=>z(Xe,"$isMobile",l),c=()=>z(Fe,"$manga",l),r=()=>z(g,"$isMuted",l),d=()=>z(Ke,"$bgmVolume",l),x=()=>z(Ye,"$seVolume",l),f=()=>z(Qe,"$voiceVolume",l);let i=I(0),n=I(0),g=qe("muted",!1);ce(()=>(b(),window.addEventListener("popstate",b),window.addEventListener("pushstate",b),()=>{window.removeEventListener("popstate",b),window.removeEventListener("pushstate",b)}));const b=()=>{const e=new URLSearchParams(window.location.search),t=e.get("chapter"),s=e.get("page");t&&p(i,parseInt(t,10)||0,!0),s&&p(n,parseInt(s,10)||0,!0)};let w={};const E=async({page:e,chapterIndex:t})=>{const s=`${t}-${e}`;return w[s]===void 0&&(w[s]=URL.createObjectURL(await De({chapterIndex:t,page:e}))),w[s]};let $={};const V=async e=>($[e]===void 0&&($[e]=URL.createObjectURL(await Ge(e))),$[e]);let N={};const H=async e=>(N[e]===void 0&&(N[e]=URL.createObjectURL(await Je(e))),N[e]);let T=I(null),X=I(je([]));function j(e){if(te(),e instanceof KeyboardEvent)e.key==="ArrowLeft"?(e.preventDefault(),J()):e.key==="ArrowRight"&&(e.preventDefault(),K());else if(u()&&e instanceof PointerEvent){const t=e.clientX,s=window.innerWidth;t<s*.3?J():K()}}let M=I(!1);function te(){if(a(M))return;document.querySelectorAll(".background-sound").forEach(t=>{t instanceof HTMLAudioElement&&t.play().then(()=>{p(M,!0)}).catch(s=>{console.error("Background sound play failed:",s)})})}function J(){if(a(n)>0)p(n,a(n)-1);else if(a(i)>0){if(c()&&c().chapters[a(i)-1]){const e=c().chapters[a(i)-1].pages.length-1;p(i,a(i)-1),p(n,e)}}else{alert("No more pages");return}de(`/reader?chapter=${a(i)}&page=${a(n)}`,{}),p(M,!1)}function K(){if(c()&&c().chapters[a(i)]&&a(n)<c().chapters[a(i)].pages.length-1)p(n,a(n)+1);else if(c()&&a(i)<c().chapters.length-1)p(n,0),p(i,a(i)+1);else{alert("No more pages");return}de(`/reader?chapter=${a(i)}&page=${a(n)}`,{}),p(M,!1)}const ve=async({page:e,bgm:t,se:s,voice:k})=>{p(T,await E({page:e,chapterIndex:a(i)}),!0);let h=[];t!==null&&(h=[...h,{url:await V(t),loop:!0,type:"bgm"}]);for(const m of s)h=[...h,{url:await H(m),loop:!0,type:"se"}];k&&(h=[...h,{url:URL.createObjectURL(await He({chapterIndex:a(i),page:e})),loop:!1,type:"voice"}]),p(X,h,!0),setTimeout(te,100)};Ie(()=>{if(c()===null){alert("Manga not initialized");return}const e=c().chapters[a(i)];if(e===void 0){alert(`Chapter ${a(i)+1} not found`);return}const t=e.pages[a(n)];if(t===void 0){alert(`Page ${a(n)+1} not found`);return}ve(t)}),ce(()=>(document.addEventListener("click",j),document.addEventListener("keydown",j),()=>{document.removeEventListener("click",j),document.removeEventListener("keydown",j)}));var ae=mt(),oe=R(ae);{var ge=e=>{var t=lt();t.__click=[it,r,g];var s=P(t);{var k=m=>{rt(m,{size:30})},h=m=>{st(m,{size:30})};W(s,m=>{r()?m(k):m(h,!1)})}L(t),O(()=>ee(t,"aria-label",r()?"Unmute audio":"Mute audio")),_(e,t)};W(oe,e=>{u()||e(ge)})}var Y=B(oe,2),ne=P(Y);{var pe=e=>{var t=ct(),s=P(t);s.__click=J;var k=P(s);ot(k,{size:48}),L(s),L(t),_(e,t)};W(ne,e=>{u()||e(pe)})}var Q=B(ne,2),he=P(Q);{var _e=e=>{var t=dt();O(()=>ee(t,"src",a(T))),_(e,t)};W(he,e=>{a(T)!==null&&e(_e)})}L(Q);var $e=B(Q,2);{var ye=e=>{var t=ut(),s=P(t);s.__click=K;var k=P(s);nt(k,{size:48}),L(s),L(t),_(e,t)};W($e,e=>{u()||e(ye)})}L(Y);var be=B(Y,2);me(be,17,()=>a(X),({url:e,loop:t,type:s})=>e,(e,t)=>{let s=()=>a(t).url,k=()=>a(t).loop,h=()=>a(t).type;var m=ft(),we=P(m);L(m),O(()=>{m.loop=k(),m.volume=(h()==="bgm"?d():h()==="se"?x():f())/100,m.muted=r(),ee(we,"src",s())}),_(e,m)}),_(v,ae),fe(),y()}xe(["click"]);export{Pt as component};
